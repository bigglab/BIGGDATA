{% extends '_base.html' %}

{% block content %}


<div class="container">
	<h4>Files Associated Directly With Your User:
	<button data-toggle="collapse" data-target="#directfiles" class="btn">></button>
	</h4>
	<br>
	<div id="directfiles" class="collapse">
	{% set files = files %}
	{% include "partials/files.html" with context %}
	</div>
</div>

<br>
<br>

<div class="container">
	<div class="row">
		<div class="col-md-6">
			<div class="input-group">
				<span class="input-group-btn">
				<!-- Button -->
						<button class="btn btn-default dropdown-toggle dropdown" type="button" data-toggle="dropdown">Projects<span class="caret"></span></button>
							<ul class="dropdown-menu">
								{% for project in current_user.projects %}
									{% if project.datasets != [] %}
										<li data-toggle="collapse" data-target=#{{project.project_name}}><a href="#">{{project.id}} {{project.project_name}}</a></li>
									{% endif %}
								{% endfor %}
							</ul>
				<!-- Button End -->
				</span>
				<!-- Input Bar -->
				<div id="projectsearch">
					<input id="projects" class="typeahead form-control" type="text" name='projects' autocomplete="off" value="" placeholder="Search for project" aria-describedby="sizing-addon1"/>
				</div>
				<script>
						var projectnames = {{ projectnames|safe }};
						for (var i = 0; i < projectnames.length; i++){
							projectnames[i] = projectnames[i].replace(/"/g, '')
						};
						var projects = new Bloodhound({
							datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d); },
  							queryTokenizer: Bloodhound.tokenizers.whitespace,
  							local: projectnames,
		  					});

						projects.initialize();

						$('#projectsearch .typeahead').typeahead({
							highlight: true,
							minLength: 1,
						},
						{
							name: 'projects',
							limit: 10,
							source: projects.ttAdapter(),
						});
				</script>
				<span class ="input-group-btn">
					<button id="go" class="btn btn-default" type="button" onclick="clickgo()">Go</button>
				<script>
					function clickgo(){
					var project = '#'.concat( $('#projects').val() );
					$(projects).collapse('toggle');
					}
				</script>		
				</span>	
			</div>
		</div>
	</div>
	<br>
	<br>
	{% for project in current_user.projects %}
		{% if project.datasets != [] %}
		<div id={{project.project_name}} class="collapse">
		{% for dataset in current_user.datasets %}
			{% if dataset.files.all() != [] %}
			<br>
			<div id={{dataset.name}}>
				<h4>Files Associated With Your Dataset {{dataset.id}} {{dataset.name}}</h4>
					{% set files = dataset.files %}
					{% include "partials/files.html" with context %}
					{% endif %}
			</div>
		{% endfor %}
		</div>
		{% endif %}
	{% endfor %}
</div>






<div class="container">
<br>
{% if dropbox_files %}
	<h2>Or click to add any of these from your dropbox:</h2>
	<table class="table table-striped">
		<thead>
			<tr>
				<th></th>
			</tr>
		</thead>
		<tbody>
			{% for file in dropbox_files %}
				<tr>
					<form role='form' method='POST' action='/files'>
					<th><input type='submit' name='submit' value={{file}}></th>
					</form>
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% endif %}
</div>
{%endblock content %}



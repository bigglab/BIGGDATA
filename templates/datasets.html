{% extends '_base.html' %}

{% block head %}
    {{super()}}
	<!-- <link rel="stylesheet" href="/static/jquery.dataTables.min.css"> -->
{% endblock head %}

{% block content %}
	<div class="container">
		    <form method="POST" action="/datasets">
		    <table class='table table-striped'> 
			    <thead>
				    <h4>Create A New Dataset:</h4>
				    <tr>
					    <!-- <th>{{ form.csrf_token }}</th> -->
				    	<th>{{ form.name.label }}:</th>
				    	<th>Description:</th>
				    	<th><label>Add to Project:</label></th>
				    	<!-- <th><label>Pairing:</label></th> -->
				    	<th></th>
					</tr>
			    </thead>
				<tbody>
				    <tr>
    			        <!-- <th></th> -->
    			        <th>{{ form.name(size=15, class="form-control") }}</th>
    			        <th>{{ form.description(size=15, class="form-control") }}</th>
    			        <!-- <th>Ig Type: {{ form.ig_type(size=10) }}</th> -->
    			        <th>{{ form.project(class="form-control") }}</th>
    			        <th>
<!-- 							<div class="checkbox" class="pull-right">
                                        <label>
										{{ form.paired }}
                                        Expect VH/VL Paired Data?
                                        </label><br/>
                            </div>
 -->    			        </th>
    			        <th><input class="btn btn-default form-control" type="submit" value="Submit"></th>
    		        </tr>
		        </tbody>
	            </table>
		    </form>
	</div>

<br>
<div class="container">
    <h4>Existing Datasets:</h4>
	<table id="datasets" class="display table-striped table table-bordered" cellspacing="0" width="100%">
		<thead>
			<tr>
				<th class='no-sort'> </th>
				<th>Dataset #</th>
				<th>Name</th>
				<th>Description</th>
				<th>Projects</th>
				<th class='no-sort'>Run Analysis</th>
				<th> </th>
			</tr>
		</thead>
		<tbody>
			{% for dataset, files in datadict.iteritems() %}
				<tr>
					<td {% if files != [] -%}class='details-control'{%- endif -%}></td>
					<td><a href="{{url_for('.dataset', id=dataset.id)}}">{{dataset.id}}</a></td>
					<td><a href="{{url_for('.dataset', id=dataset.id)}}">{{dataset.name}}</a></td>
					<td>{{dataset.description}}</td>
					<td>{{dataset.projects|map(attribute='project_name')|join(',')}}</td>
					<td>
						{%- if files == [] -%}
							<a href="{{url_for('.dataset', id=dataset.id)}}">Click To Add Files</a>
						{% else %}
							<a href="{{url_for('.pandaseq', dataset_id=dataset.id)}}">PANDASEQ</a>  <a href="{{url_for('.pipeline', dataset_id=dataset.id)}}">ANNOTATE</a>
						{% endif %}
					</td>
					<td><a href="{{url_for('.delete_dataset', id=dataset.id)}}">Delete</a></td>
				</tr>
			{% endfor %}
			
		</tbody>
	</table>
</div>

<script>
	
	var table = $('#datasets').DataTable({
		columnDefs: [
  		{ targets: 'no-sort', orderable: false }
  		],
  		order: [[ 1, 'desc' ]], 
  		pageLength:100
	});
 
	var table_data = [
	{%- for dataset, files in datadict.iteritems() -%}
		{%- if files == [] -%}
			`<a href="{{url_for('.dataset', id=dataset.id)}}">Click Here To Add Files To Dataset {{dataset.id}}</a><br/>`,
		{% else %}
			{%- set files = files -%}
			`{%- include "partials/files_no_preview.html" with context %}`,
		{% endif %}
	{%- endfor -%}
		''
	]
	table.rows().every( function () {
	    this.child( table_data[this.index()] );
	} );

	$('#datasets tbody').on( 'click', 'td.details-control', function () {
	    var child = table.row( this ).child;
		var tr = $(this).closest('tr');
	    
	    if ( child.isShown() ) {
	        child.hide();
	        tr.removeClass('shown');
	    }
	    else {
	        child.show();
	        tr.addClass('shown')
	    }
	} );
</script>




{%endblock content %}

